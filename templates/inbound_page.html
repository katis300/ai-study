{% extends "base.html" %}

{% block title %}입고 관리 - AI WMS{% endblock %}

{% block content %}
    <style>
        .form-container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 20px auto;
        }
        .form-container h2 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group select,
        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .form-group button {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 10px;
        }
        .form-group button:hover {
            background-color: #45a049;
        }
        .message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
        }
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>

    <div class="form-container">
        <h2>제품 입고</h2>
        <div id="inbound-message" class="message" style="display:none;"></div>
        <form id="inbound-form">
            <div class="form-group">
                <label for="product_id">제품명:</label>
                <select id="product_id" name="product_id" required>
                    <option value="">제품을 선택하세요</option>
                    {% for product_id, product_name in products %}
                        <option value="{{ product_id }}">{{ product_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="quantity">수량:</label>
                <input type="number" id="quantity" name="quantity" min="1" required>
            </div>
            <div class="form-group">
                <label for="location_id">보관 로케이션:</label>
                <select id="location_id" name="location_id" required>
                    <option value="">로케이션을 선택하세요</option>
                    {% for location_id, location_code in locations %}
                        <option value="{{ location_id }}">{{ location_code }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <button type="submit">입고 처리</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('inbound-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // 폼 기본 제출 방지

            const productId = document.getElementById('product_id').value;
            const quantity = document.getElementById('quantity').value;
            const locationId = document.getElementById('location_id').value;
            const messageDiv = document.getElementById('inbound-message');

            // 메시지 초기화
            messageDiv.style.display = 'none';

            if (!productId || !quantity || !locationId) {
                messageDiv.textContent = '모든 필드를 입력해주세요.';
                messageDiv.className = 'message error';
                messageDiv.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/inbound_process', { // 새로운 라우트
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        product_id: parseInt(productId), 
                        quantity: parseInt(quantity), 
                        location_id: parseInt(locationId) 
                    })
                });
                const data = await response.json();
                if (response.ok) { // HTTP 상태 코드가 2xx (성공)인 경우
                    messageDiv.textContent = data.message;
                    messageDiv.className = 'message success';
                    document.getElementById('inbound-form').reset(); // 폼 초기화
                } else { // HTTP 상태 코드가 4xx 또는 5xx (에러)인 경우
                    messageDiv.textContent = data.message || '입고 처리 중 오류가 발생했습니다.';
                    messageDiv.className = 'message error';
                }
            } catch (error) {
                console.error('Error:', error);
                messageDiv.textContent = '서버와 통신 중 오류가 발생했습니다.';
                messageDiv.className = 'message error';
            }
            messageDiv.style.display = 'block';
        });
    </script>
{% endblock %}